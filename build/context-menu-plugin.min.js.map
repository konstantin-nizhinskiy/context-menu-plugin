{"version":3,"file":"context-menu-plugin.min.js","sources":["../src/utils.js","../src/menu/debounceHide.js","../src/menu/index.js","../src/main-menu.js","../src/node-menu.js","../src/connection-menu.js","../src/index.js"],"sourcesContent":["export function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\n\nexport async function createNode(component, { data = {}, meta = {}, x = 0, y = 0 }) {\n    const node = await component.createNode(deepCopy(data));\n\n    node.meta = Object.assign(deepCopy(meta), node.meta);\n    node.position[0] = x;\n    node.position[1] = y;\n    \n    return node;\n}\n\nexport function traverse(items, callback, path = []) {\n    if (typeof items !== 'object') return;\n\n    Object.keys(items).map(key => {\n        if (typeof items[key] === 'function')\n            callback(key, items[key], path)\n        else \n            traverse(items[key], callback, [...path, key])\n    })\n}\n\nexport function fitViewport([x, y], element) {\n    return [\n        Math.min(x, window.innerWidth - element.clientWidth),\n        Math.min(y, window.innerHeight - element.clientHeight)\n    ]\n}\nexport function isFunction(param){\n    return \"function\"===typeof param\n}\n\n","import { debounce } from 'lodash-es';\n\nexport default (hideMethod) => ({\n    props: { delay: { type: Number, required: true } },\n    data() {\n        return {\n            timeoutHide: () => {}\n        }\n    },\n    methods: {\n        cancelHide() {\n            const hide = this.timeoutHide;\n    \n            if (hide && hide.cancel)\n                this.timeoutHide.cancel();\n        }\n    },\n    mounted() {\n        this.timeoutHide = debounce(this[hideMethod], this.delay);\n    }\n})","import Menu from './Menu.vue';\nimport Vue from 'vue';\n\nexport default class {\n    \n    constructor(editor, props, vueComponent) {\n        const el = document.createElement('div');\n\n        editor.view.container.appendChild(el);\n\n        this.menu = new Vue({\n            render: h => h(vueComponent || Menu, { props })\n        }).$mount(el);\n    }\n\n    addItem(...args) {\n        this.menu.$emit('additem', ...args);\n    }\n\n    show(...args) {\n        this.menu.$emit('show', ...args);\n    }\n\n    hide() {\n        this.menu.$emit('hide');\n    }\n}","import { createNode, traverse } from './utils';\nimport Menu from './menu/index';\n\nexport default class MainMenu extends Menu {\n    constructor(editor, props, vueComponent, { items, allocate, rename }) {\n        super(editor, props, vueComponent);\n        \n        const mouse = { x: 0, y: 0 };\n\n        editor.on('mousemove', ({ x, y }) => {\n            mouse.x = x;\n            mouse.y = y;\n        });\n        \n        for(const component of editor.components.values()) {\n            const path = allocate(component);\n    \n            if (Array.isArray(path)) { // add to the menu if path is array\n                this.addItem(rename(component), async () => {\n                    editor.addNode(await createNode(component, mouse));\n                }, path);\n            }\n        }\n    \n        traverse(items, (name, func, path) => this.addItem(name, func, path))\n    }\n}","import Menu from './menu/index';\nimport { createNode, traverse } from './utils';\n\nexport default class NodeMenu extends Menu {\n    constructor(editor, props, vueComponent, nodeItems) {\n        super(editor, props, vueComponent);\n\n        if (nodeItems['Delete'] !== false) {\n            this.addItem('Delete', ({ node }) => editor.removeNode(node));\n        }\n        if (nodeItems['Clone'] !== false) {\n            this.addItem('Clone', async (args) => {\n                const { name, position: [x, y], ...params } = args.node;\n                const component = editor.components.get(name);\n                const node = await createNode(component, { ...params, x: x + 10, y: y + 10 });\n\n                editor.addNode(node);\n            });\n        }\n\n        traverse(nodeItems, (name, func, path) => this.addItem(name, func, path))\n    }\n}\n","import Menu from './menu/index';\nimport {traverse} from './utils';\n\nexport default class ConnectionMenu extends Menu {\n    constructor(editor, props, vueComponent, connectionItems, con) {\n        super(editor, props, vueComponent);\n        if (connectionItems[\"add_pink\"] !== false) {\n            if (connectionItems[\"add_pink\"] && \"function\" != typeof connectionItems[\"add_pink\"]) {\n                if (connectionItems[\"add_pink\"].title && connectionItems[\"add_pink\"].callback) {\n\n                    this.addItem(connectionItems[\"add_pink\"].title, () => connectionItems[\"add_pink\"].callback(editor, con))\n\n                } else if (connectionItems[\"add_pink\"].title) {\n                    if (\"function\" === typeof con.connection.addPink) {\n                        this.addItem(connectionItems[\"add_pink\"].title, () => con.connection.addPink())\n                    }\n                }\n            } else {\n                if (\"function\" === typeof con.connection.addPink) {\n                    this.addItem('Add pink', () => con.connection.addPink())\n                }\n            }\n        }\n        if (connectionItems[\"colors\"] !== false) {\n            let changColor = (color) => {\n                con.connection.data.color = color\n                con.el.querySelector('.connection path').style.setProperty(\"stroke\", color)\n            }\n            if (connectionItems[\"colors\"] && \"function\" != typeof connectionItems[\"colors\"]) {\n                if (connectionItems[\"colors\"].title && connectionItems[\"colors\"].colors && connectionItems[\"colors\"].callback) {\n\n                    for (var key in connectionItems[\"colors\"].colors) {\n                        this.addItem(key, (color => () => connectionItems[\"colors\"].callback(editor, con, color))(connectionItems[\"colors\"].colors[key]), [connectionItems[\"colors\"].title])\n                    }\n                } else if (connectionItems[\"colors\"].title && connectionItems[\"colors\"].colors) {\n                    for (var key in connectionItems[\"colors\"].colors) {\n                        this.addItem(key, (color => () => changColor(color))(connectionItems[\"colors\"].colors[key]), [connectionItems[\"colors\"].title])\n                    }\n                }\n            } else {\n                let colors = {\n                    \"RED\": \"red\",\n                    \"black\": \"black\",\n                    \"blue\": \"blue\",\n                    \"yellow\": \"yellow\",\n\n                }\n                for (var key in colors) {\n                    this.addItem(key, (color => () => changColor(color))(colors[key]), [\"Colors\"])\n                }\n            }\n\n        }\n        if (connectionItems[\"delete_connection\"] !== false) {\n            let deleteConnection = () => {\n                editor.removeConnection(con.connection)\n            }\n            if (connectionItems[\"delete_connection\"] && \"function\" != typeof connectionItems[\"delete_connection\"]) {\n                if (connectionItems[\"delete_connection\"].title && connectionItems[\"delete_connection\"].callback) {\n\n                    this.addItem(connectionItems[\"delete_connection\"].title, () => connectionItems[\"delete_connection\"].callback(editor, con))\n\n                } else if (connectionItems[\"delete_connection\"].title) {\n                        this.addItem(connectionItems[\"delete_connection\"].title, () => deleteConnection())\n                }\n            } else {\n                    this.addItem('Delete connection', () => deleteConnection())\n\n            }\n        }\n           traverse(connectionItems, (name, func, path) => this.addItem(name, func, path))\n    }\n}\n","import MainMenu from './main-menu';\nimport NodeMenu from './node-menu';\nimport VueItem from './menu/Item.vue';\nimport VueMenu from './menu/Menu.vue';\nimport VueSearch from './menu/Search.vue';\nimport { isFunction } from './utils';\nimport ConnectionMenu from \"./connection-menu\";\n\nfunction install(editor, {\n    searchBar = true,\n    searchKeep = () => false,\n    delay = 1000,\n    items = {},\n    nodeItems = {},\n    connectionItems = {},\n    allocate = () => [],\n    rename = component => component.name,\n    vueComponent = null\n}) {\n    editor.bind('hidecontextmenu');\n    editor.bind('showcontextmenu');\n\n    let menu = null;\n\n    editor.on('hidecontextmenu', () => {\n        if (menu) menu.hide();\n    });\n\n    editor.on('click contextmenu', () => {\n        editor.trigger('hidecontextmenu');\n    });\n\n    editor.on('contextmenu', ({ e, node,connection }) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!editor.trigger('showcontextmenu', { e, node })) return;\n\n        const [x, y] = [e.clientX, e.clientY];\n\n        if(connection) {\n            menu = new ConnectionMenu(editor, { searchBar: false, delay }, vueComponent,  isFunction(connectionItems) ? connectionItems(node) : connectionItems,connection);\n            menu.show(x, y);\n        } else if(node) {\n            menu = new NodeMenu(editor, { searchBar: false, delay }, vueComponent,  isFunction(nodeItems) ? nodeItems(node) : nodeItems);\n            menu.show(x, y, { node });\n        } else {\n            menu = new MainMenu(editor, { searchBar, searchKeep, delay }, vueComponent, { items, allocate, rename });\n            menu.show(x, y);\n        }\n    });\n}\n\nexport const Menu = VueMenu;\nexport const Item = VueItem;\nexport const Search = VueSearch;\n\nexport default {\n    name: 'context-menu',\n    install\n}\n"],"names":["deepCopy","obj","JSON","parse","stringify","createNode","component","data","meta","x","y","node","Object","assign","position","traverse","items","callback","path","_typeof","keys","map","key","isFunction","param","hideMethod","props","delay","type","Number","required","timeoutHide","methods","cancelHide","hide","this","cancel","mounted","debounce","element","Math","min","window","innerWidth","clientWidth","innerHeight","clientHeight","editor","vueComponent","el","document","createElement","view","container","appendChild","menu","Vue","render","h","Menu","$mount","args","$emit","MainMenu","allocate","rename","mouse","on","Array","isArray","addItem","addNode","components","values","name","func","_this","NodeMenu","nodeItems","removeNode","params","get","ConnectionMenu","connectionItems","con","title","connection","addPink","changColor","color","querySelector","style","setProperty","colors","deleteConnection","removeConnection","VueMenu","Item","VueItem","Search","VueSearch","install","searchBar","searchKeep","bind","trigger","e","preventDefault","stopPropagation","clientX","clientY","show"],"mappings":"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"}